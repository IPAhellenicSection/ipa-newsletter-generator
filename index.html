<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA Newsletter Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=Roboto+Slab:wght@300;400;500;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; background: #f8fafc; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .auth-section, .newsletter-form { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .newsletter-preview { background: white; padding: 2rem; border-radius: 8px; }
        h1 { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 900; color: #1f2937; text-align: center; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #1f2937; }
        input, select, textarea { width: 100%; padding: 0.5rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 4px; font-family: 'Source Sans 3', sans-serif; }
        button { background: #1e3a8a; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
        button:hover { background: #2563eb; }
        .status-message { margin: 1rem 0; padding: 0.75rem; border-radius: 4px; }
        .success { background: #dcfce7; color: #166534; }
        .error { background: #fee2e2; color: #991b1b; }
        .newsletter { max-width: 210mm; margin: 0 auto; background: white; }
        .newsletter-header { background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #fbbf24 100%); color: white; padding: 2rem; text-align: center; page-break-inside: avoid; }
        .newsletter-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 900; margin-bottom: 0.5rem; }
        .newsletter-date { font-size: 14px; background: rgba(255,255,255,0.15); padding: 6px 15px; border-radius: 8px; }
        .cover-page, .back-cover-page { width: 210mm; height: 297mm; object-fit: cover; page-break-after: always; }
        .toc-page { padding: 1rem; background: white; page-break-inside: avoid; }
        .toc-title { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 1rem; }
        .toc-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-family: 'Source Sans 3', sans-serif; font-size: 12px; }
        .article { page-break-inside: avoid; margin: 1rem; }
        .article img { max-width: 200px; height: auto; border-radius: 8px; }
        .article-title { font-family: 'Roboto Slab', serif; font-size: 20px; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; }
        .article-text { font-family: 'Source Sans 3', sans-serif; font-size: 12px; color: #64748b; }
        .qr-section { text-align: center; margin-top: 1rem; padding: 1rem; border-top: 2px solid #1e3a8a; }
        .qr-section h3 { font-family: 'Roboto Slab', serif; font-size: 16px; font-weight: 600; margin-bottom: 0.5rem; }
        .qr-section h4 { font-family: 'Roboto Slab', serif; font-size: 14px; font-weight: 500; margin-bottom: 0.5rem; }
        .qr-section img { width: 80px; height: 80px; margin: 0.5rem auto; }
        .newsletter-footer { background: #f8fafc; padding: 1rem; text-align: center; color: #64748b; border-top: 3px solid #1e3a8a; page-break-inside: avoid; }
        .style-hero { background: #f8fafc; padding: 2rem; text-align: center; }
        .style-hero .article-image { max-width: 100%; margin-bottom: 1rem; }
        .style-sidebyside { display: flex; align-items: center; gap: 1rem; }
        .style-sidebyside .article-image { flex: 1; max-width: 50%; }
        .style-sidebyside .article-content { flex: 1; }
        .style-card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .style-magazine { background: white; padding: 1rem; border-left: 4px solid #1e3a8a; }
        .style-overlay { position: relative; color: white; }
        .style-overlay .article-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .style-overlay .article-content { background: linear-gradient(transparent, rgba(0,0,0,0.ğŸ˜); color: white; padding: 1rem; width: 100%; }
        .style-minimal { background: #f8fafc; padding: 1rem; text-align: center; }
        .style-minimal .article-image { max-width: 200px; margin-bottom: 0.5rem; }
        @media print {
            .newsletter { margin: 0; }
            .article, .newsletter-header, .newsletter-footer { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication Section -->
        <div class="auth-section" id="authSection">
            <h1>Î£ÏÎ½Î´ÎµÏƒÎ·</h1>
            <label for="username">ÎŒÎ½Î¿Î¼Î± Î§ÏÎ®ÏƒÏ„Î· (Email):</label>
            <input type="email" id="username" placeholder="email@example.com">
            <label for="password">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:</label>
            <input type="password" id="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚">
            <button onclick="login()">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
            <div class="status-message" id="authStatus"></div>
        </div>

        <!-- Newsletter Form (Hidden until login) -->
        <div class="newsletter-form" id="newsletterForm" style="display: none;">
            <h1>IPA Newsletter Generator</h1>
            <label for="newsletterTitle">Î¤Î¯Ï„Î»Î¿Ï‚ Newsletter:</label>
            <input type="text" id="newsletterTitle" placeholder="Î .Ï‡. IPA Newsletter">
            <label for="newsletterMonth">ÎœÎ®Î½Î±Ï‚:</label>
            <select id="newsletterMonth">
                <option value="Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚">Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚</option>
                <option value="Î¦ÎµÎ²ÏÎ¿Ï…Î¬ÏÎ¹Î¿Ï‚">Î¦ÎµÎ²ÏÎ¿Ï…Î¬ÏÎ¹Î¿Ï‚</option>
                <option value="ÎœÎ¬ÏÏ„Î¹Î¿Ï‚">ÎœÎ¬ÏÏ„Î¹Î¿Ï‚</option>
                <option value="Î‘Ï€ÏÎ¯Î»Î¹Î¿Ï‚">Î‘Ï€ÏÎ¯Î»Î¹Î¿Ï‚</option>
                <option value="ÎœÎ¬Î¹Î¿Ï‚">ÎœÎ¬Î¹Î¿Ï‚</option>
                <option value="Î™Î¿ÏÎ½Î¹Î¿Ï‚">Î™Î¿ÏÎ½Î¹Î¿Ï‚</option>
                <option value="Î™Î¿ÏÎ»Î¹Î¿Ï‚">Î™Î¿ÏÎ»Î¹Î¿Ï‚</option>
                <option value="Î‘ÏÎ³Î¿Ï…ÏƒÏ„Î¿Ï‚" selected>Î‘ÏÎ³Î¿Ï…ÏƒÏ„Î¿Ï‚</option>
                <option value="Î£ÎµÏ€Ï„Î­Î¼Î²ÏÎ¹Î¿Ï‚">Î£ÎµÏ€Ï„Î­Î¼Î²ÏÎ¹Î¿Ï‚</option>
                <option value="ÎŸÎºÏ„ÏÎ²ÏÎ¹Î¿Ï‚">ÎŸÎºÏ„ÏÎ²ÏÎ¹Î¿Ï‚</option>
                <option value="ÎÎ¿Î­Î¼Î²ÏÎ¹Î¿Ï‚">ÎÎ¿Î­Î¼Î²ÏÎ¹Î¿Ï‚</option>
                <option value="Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚">Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚</option>
            </select>
            <label for="newsletterYear">ÎˆÏ„Î¿Ï‚:</label>
            <input type="number" id="newsletterYear" value="2025">
            <label for="coverImage">Î•Î¾ÏÏ†Ï…Î»Î»Î¿ (JPG, A4 Î±Î½Î±Î»Î¿Î³Î¯Î±):</label>
            <input type="file" id="coverImage" accept="image/jpeg">
            <label for="backCoverImage">ÎŸÏ€Î¹ÏƒÎ¸ÏŒÏ†Ï…Î»Î»Î¿ (JPG):</label>
            <input type="file" id="backCoverImage" accept="image/jpeg">
            <label for="articlesFile">Î†ÏÎ¸ÏÎ± (DOCX Î® Text):</label>
            <input type="file" id="articlesFile" accept=".docx,.txt">
            <button onclick="generateNewsletter()">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Newsletter</button>
            <button onclick="exportToDocx()">Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ DOCX</button>
            <button onclick="exportToHtml()">Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ HTML</button>
            <button onclick="exportToPdf()">Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ PDF</button>
            <button onclick="shareOnline()">Î”Î¹Î±Î¼Î¿Î¹ÏÎ±ÏƒÎ¼ÏŒÏ‚ Online</button>
            <div class="status-message" id="status"></div>
        </div>

        <!-- Preview Section -->
        <div class="newsletter-preview" id="newsletterPreview"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.28.0/docxtemplater.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.16/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        // Firebase Configuration (Replace with your Firebase project details)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Translations
        const translations = {
            el: {
                loginSuccess: "Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·!",
                loginError: "Î›Î¬Î¸Î¿Ï‚ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Î® ÎºÏ‰Î´Î¹ÎºÏŒÏ‚.",
                coverImageError: "Î¤Î¿ ÎµÎ¾ÏÏ†Ï…Î»Î»Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ JPG Î¼Îµ Î±Î½Î±Î»Î¿Î³Î¯Î± A4 (210x297mm).",
                articleProcessingError: "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¬ÏÎ¸ÏÏ‰Î½.",
                newsletterGenerated: "Î¤Î¿ newsletter Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î¼Îµ ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±!",
                docxExported: "Î¤Î¿ newsletter ÎµÎ¾Î®Ï‡Î¸Î· ÏƒÎµ DOCX!",
                htmlExported: "Î¤Î¿ newsletter ÎµÎ¾Î®Ï‡Î¸Î· ÏƒÎµ HTML!",
                pdfExported: "Î¤Î¿ newsletter ÎµÎ¾Î®Ï‡Î¸Î· ÏƒÎµ PDF!",
                shareSuccess: "Î¤Î¿ newsletter Î´Î¹Î±Î¼Î¿Î¹ÏÎ¬ÏƒÏ„Î·ÎºÎµ online!",
                shareError: "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î¿Î½ Î´Î¹Î±Î¼Î¿Î¹ÏÎ±ÏƒÎ¼ÏŒ. Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ ÎµÎ¯ÏƒÏ„Îµ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Î¹."
            }
        };

        // Default IPA Houses
        const defaultIpaHouses = [
            { title: "ÎÎµÎ½ÏÎ½Î±Ï‚ ÎÏ…Î¼Ï†Î±Î¯Î¿Ï…", content: "Î¤Î¿ ÎµÎ»Î»Î·Î½Î¹ÎºÏŒ ÎµÎ¸Î½Î¹ÎºÏŒ Ï„Î¼Î®Î¼Î± Ï„Î·Ï‚ Î™Î¡Î‘ Î±Ï€ÏŒ Ï„Î¿ 2016 Î±Ï€Î­ÎºÏ„Î·ÏƒÎµ Î­Î½Î± Ï€Î¿Î»ÏÏ„Î¹Î¼Î¿ Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¹Î±ÎºÏŒ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿. Î ÏÏŒÎºÎµÎ¹Ï„Î±Î¹ Î³Î¹Î± Ï„Î¿ IPA House Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ ÏƒÏ„Î¿ ÎÏ…Î¼Ï†Î±Î¯Î¿ Î¦Î»ÏÏÎ¹Î½Î±Ï‚, ÏƒÏ„Î¿ ÎºÏ„Î¯ÏƒÎ¼Î± Ï„Î¿Ï… Ï€Î±Î»Î¹Î¿Ï Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï Î£Ï„Î±Î¸Î¼Î¿Ï ÎºÎ±Î¹ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï€Î»Î­Î¿Î½ Ï„Î¿Î½ Î¹Î´Î±Î½Î¹ÎºÏŒÏ„ÎµÏÎ¿..." },
            { title: "ÎÎµÎ½ÏÎ½Î±Ï‚ Î§Î±Î½Î¯Ï‰Î½", content: "Î‘Ï€ÏŒ Ï„Î·Ï‚ 10 Î‘Ï…Î³Î¿ÏÏƒÏ„Î¿Ï… 2019, ÏƒÎµ Î­Î½Î± Î¼Î±Î³ÎµÏ…Ï„Î¹ÎºÏŒ Î¼Î­ÏÎ¿Ï‚ 15 Ï€ÎµÏÎ¯Ï€Î¿Ï… Ï‡Î¹Î»Î¹ÏŒÎ¼ÎµÏ„ÏÎ± Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏŒÎ»Î· Ï„Ï‰Î½ Î§Î±Î½Î¯Ï‰Î½ Î¬ÏÏ‡Î¹ÏƒÎµ Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¿ ÎÎµÎ½ÏÎ½Î±Ï‚ Ï„Ï‰Î½ Î§Î±Î½Î¯Ï‰Î½ Î™Î¡Î‘ HOUSE Î§Î±Î½Î¹Î¬ (Î“ÎµÏÏÎ³Î¹Î¿Ï‚ ÎšÎ±Ï„ÏƒÎ±ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚)..." },
            { title: "ÎÎµÎ½ÏÎ½Î±Ï‚ Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·Ï‚", content: "ÎŸ ÎÎµÎ½ÏÎ½Î±Ï‚ Ï„Î¿Ï… Î•Î»Î»Î·Î½Î¹ÎºÎ¿Ï Î•Î¸Î½Î¹ÎºÎ¿Ï Î¤Î¼Î®Î¼Î±Ï„Î¿Ï‚ Ï„Î·Ï‚ Î”Î¹ÎµÎ¸Î½Î¿ÏÏ‚ Î•Î½ÏÏƒÎµÏ‰Ï‚ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏÎ½ ÏƒÏ„Î·Î½ Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·, ÏƒÏ„ÎµÎ³Î¬Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿Î½ 6Î¿ ÏŒÏÎ¿Ï†Î¿ Ï€Î¿Î»Ï…ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î±Ï‚ ÎµÏ€Î¯ Ï„Î·Ï‚ Î¿Î´Î¿Ï Î£Ï…Î³Î³ÏÎ¿Ï 28..." },
            { title: "ÎÎµÎ½ÏÎ½Î±Ï‚ Î§Î¯Î¿Ï…", content: "ÎŸ ÎÎµÎ½ÏÎ½Î±Ï‚ Ï„Î·Ï‚ Î”Î¹ÎµÎ¸Î½Î¿ÏÏ‚ Î•Î½ÏÏƒÎµÏ‰Ï‚ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏÎ½ ÏƒÏ„Î· Î§Î¯Î¿, Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ 1,5 Ï‡Î»Î¼ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ Ï„Î·Ï‚ Ï€ÏŒÎ»Î·Ï‚..." },
            { title: "ÎÎµÎ½ÏÎ½Î±Ï‚ Î‘Î¸Î®Î½Î±Ï‚", content: "ÎŸ ÎÎµÎ½ÏÎ½Î±Ï‚ Ï„Î·Ï‚ Î”Î¹ÎµÎ¸Î½Î¿ÏÏ‚ Î•Î½ÏÏƒÎµÏ‰Ï‚ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏÎ½ ÏƒÏ„Î·Î½ Î‘Î¸Î®Î½Î±, Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿Î½ Î´ÎµÏÏ„ÎµÏÎ¿ ÏŒÏÎ¿Ï†Î¿ Ï€Î¿Î»Ï…ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î±Ï‚ ÎµÏ€Î¯ Ï„Î·Ï‚ Î¿Î´Î¿Ï Î‘Ï‡Î±ÏÎ½ÏÎ½ 21..." }
        ];

        // Sample Images
        const sampleImages = [
            "https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=200&fit=crop",
            "https://images.unsplash.com/photo-1551836022-deb4988cc6c0?w=200&fit=crop",
            "https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=200&fit=crop",
            "https://images.unsplash.com/photo-1593115057322-e94b77572f20?w=200&fit=crop"
        ];

        // Authentication
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(username, password)
                .then(() => {
                    showStatus(translations.el.loginSuccess, 'success', 'authStatus');
                    document.getElementById('authSection').style.display = 'none';
                    document.getElementById('newsletterForm').style.display = 'block';
                })
                .catch(err => {
                    console.error(err);
                    showStatus(translations.el.loginError, 'error', 'authStatus');
                });
        }

        // Status Message
        function showStatus(message, type, elementId = 'status') {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status-message ${type}`;
        }

        // Generate QR Code
        function generateQRCode(text) {
            const qrCodeDiv = document.createElement('div');
            new QRCode(qrCodeDiv, {
                text: text,
                width: 80,
                height: 80
            });
            return qrCodeDiv.querySelector('img').src;
        }

        // Generate Newsletter
        async function generateNewsletter() {
            const title = document.getElementById('newsletterTitle').value || "IPA Newsletter";
            const month = document.getElementById('newsletterMonth').value;
            const year = document.getElementById('newsletterYear').value;
            const coverImage = document.getElementById('coverImage').files[0];
            const backCoverImage = document.getElementById('backCoverImage').files[0];
            const articlesFile = document.getElementById('articlesFile').files[0];

            // Validate Cover Image
            let coverImageUrl = "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=595&h=842&fit=crop";
            if (coverImage) {
                const img = new Image();
                img.src = URL.createObjectURL(coverImage);
                await new Promise(resolve => img.onload = resolve);
                const aspectRatio = img.width / img.height;
                const a4Ratio = 210 / 297;
                if (coverImage.type !== 'image/jpeg' || Math.abs(aspectRatio - a4Ratio) > 0.1) {
                    showStatus(translations.el.coverImageError, 'error');
                    return;
                }
                coverImageUrl = img.src;
            }

            // Back Cover Image
            let backCoverImageUrl = "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=595&h=842&fit=crop";
            if (backCoverImage) {
                backCoverImageUrl = URL.createObjectURL(backCoverImage);
            }

            // Process Articles
            let articles = [];
            if (articlesFile) {
                try {
                    const arrayBuffer = await articlesFile.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    articles = result.value.split('\n\n').map((text, index) => ({
                        title: text.split('\n')[0] || `Î†ÏÎ¸ÏÎ¿ ${index + 1}`,
                        content: text.split('\n').slice(1).join('\n'),
                        image: sampleImages[index % sampleImages.length]
                    }));
                } catch (err) {
                    console.error(err);
                    showStatus(translations.el.articleProcessingError, 'error');
                    return;
                }
            }

            // Combine Articles
            const greekSectionArticles = articles.filter(a => a.title.includes("Î•Î»Î»Î·Î½Î¹ÎºÏŒ Î¤Î¼Î®Î¼Î±"));
            const otherArticles = articles.filter(a => !a.title.includes("Î•Î»Î»Î·Î½Î¹ÎºÏŒ Î¤Î¼Î®Î¼Î±"));
            const allArticles = [...greekSectionArticles, ...otherArticles, ...defaultIpaHouses];

            // Generate Table of Contents
            let toc = '<div class="toc-page"><h2 class="toc-title">Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î±</h2>';
            allArticles.forEach((article, index) => {
                toc += `<div class="toc-item"><span>${article.title}</span><span>ÏƒÎµÎ». ${index + 3}</span></div>`;
            });
            toc += '</div>';

            // Generate Articles
            const styles = ['hero', 'sidebyside', 'card', 'magazine', 'overlay', 'minimal'];
            let newsletterArticles = '';
            allArticles.forEach((article, index) => {
                const style = styles[index % styles.length];
                let qrSection = '';
                if (defaultIpaHouses.some(house => house.title === article.title)) {
                    const region = article.title.replace("ÎÎµÎ½ÏÎ½Î±Ï‚ ", "");
                    qrSection = `
                        <div class="qr-section">
                            <h3>I.P.A. House Î•Î»Î»Î¬Î´Î±Ï‚</h3>
                            <h4>Î™.Î¡.Î‘. House ${region}</h4>
                            <img src="${generateQRCode('https://www.ipa-gr.org/category/ipa/ipa-houses/')}" alt="QR Code">
                            <p>Î£Î±ÏÏÏƒÏ„Îµ Î³Î¹Î± Ï€ÏÎ¿Î²Î¿Î»Î® Ï„Î¿Ï… Î¾ÎµÎ½ÏÎ½Î±</p>
                        </div>`;
                }
                newsletterArticles += `
                    <div class="article style-${style}">
                        <img src="${article.image}" alt="${article.title}" class="article-image">
                        <div class="article-content">
                            <h2 class="article-title">${article.title}</h2>
                            <div class="article-text">${article.content}</div>
                        </div>
                        ${qrSection}
                    </div>`;
            });

            // Generate Newsletter
            const newsletter = `
                <div class="cover-page">
                    <img src="${coverImageUrl}" alt="Cover Page" class="cover-page">
                </div>
                <div class="newsletter-header">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0OCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmJiZjI0IiBzdHJva2Utd2lkdGg9IjIiLz48cGF0aCBkPSJNMTUgNTAgUTIwIDM1IDMwIDQwIFEyNSA0NSAyMCA1MCBRMjUgNTUgMzAgNjAgUTIwIDY1IDE1IDUwIiBmaWxsPSIjZmJiZjI0Ii8+PHBhdGggZD0iTTg1IDUwIFE4MCAzNSA3MCA0MCBRNzUgNDUgODAgNTAgUTc1IDU1IDcwIDYwIFE4MCA2NSA4NSA1MCIgZmlsbD0iI2ZiYmYyNCIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjM1IiBmaWxsPSIjMWUzYThhIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMjUiIGZpbGw9IiNkYzI2MjYiIG9wYWNpdHk9IjAuOCIvPjxwYXRoIGQ9Ik0zMCA0NSBRNDAgNDAgNDUgNDUgUTUwIDQwIDYwIDQ1IFE2NSA1MCA2MCA1NSBRNTAgNjAgNDUgNTUgUTQwIDYwIDMwIDU1IFEyNSA1MCAzMCA0NSIgZmlsbD0iI2VmNDQ0NCIvPjx0ZXh0IHg9IjUwIiB5PSI4NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzFlM2E4YSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgiIGZvbnQtd2VpZ2h0PSJib2xkIj5JUEE8L3RleHQ+PHJlY3QgeD0iMjAiIHk9IjkwIiB3aWR0aD0iNjAiIGhlaWdodD0iOCIgZmlsbD0iIzFlM2E4YSIgcng9IjQiLz48dGV4dCB4PSI1MCIgeT0iOTYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNSI+U0VSVk8gUEVSIEFNSUtFQ088L3RleHQ+PC9zdmc+" alt="IPA Logo" style="width: 80px; position: absolute; top: 20px; left: 20px;">
                    <div class="ipa-logo">International Police Association Hellenic Section</div>
                    <h1 class="newsletter-title">${title}</h1>
                    <div class="newsletter-date">${month} ${year}</div>
                </div>
                ${toc}
                ${newsletterArticles}
                <div class="newsletter-footer">
                    <div class="footer-logo">International Police Association Hellenic Section</div>
                    <div class="footer-month">${month} ${year}</div>
                    <p>Â© ${year} ÎŒÎ»Î± Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎºÎ±Ï„Î¿Ï‡Ï…ÏÏ‰Î¼Î­Î½Î±</p>
                    <p>Servo per Amikeco - Î¥Ï€Î·ÏÎµÏ„Ï Î´Î¹Î± Ï„Î·Ï‚ Ï†Î¹Î»Î¯Î±Ï‚</p>
                </div>
                <div class="back-cover-page">
                    <img src="${backCoverImageUrl}" alt="Back Cover" class="back-cover-page">
                </div>
            `;

            document.getElementById('newsletterPreview').innerHTML = `<div class="newsletter">${newsletter}</div>`;
            showStatus(translations.el.newsletterGenerated, 'success');
        }

        // Export to DOCX
        async function exportToDocx() {
            const newsletter = document.getElementById('newsletterPreview').innerHTML;
            const doc = new docxtemplater();
            const zip = new JSZip();
            zip.file("word/document.xml", `<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">${newsletter}</w:document>`);
            doc.loadZip(zip);
            const blob = doc.getZip().generate({ type: 'blob' });
            saveAs(blob, `IPA_Newsletter_${document.getElementById('newsletterYear').value}_${document.getElementById('newsletterMonth').value}.docx`);
            showStatus(translations.el.docxExported, 'success');
        }

        // Export to HTML
        function exportToHtml() {
            const newsletter = document.getElementById('newsletterPreview').innerHTML;
            const blob = new Blob([`
                <!DOCTYPE html>
                <html lang="el">
                <head>
                    <meta charset="UTF-8">
                    <title>IPA Newsletter</title>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=Roboto+Slab:wght@300;400;500;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
                    <style>
                        @page { margin: 0mm; size: A4; }
                        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; background: #f8fafc; }
                        .newsletter { max-width: 210mm; margin: 0 auto; background: white; }
                        .newsletter-header { background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #fbbf24 100%); color: white; padding: 2rem; text-align: center; page-break-inside: avoid; }
                        .newsletter-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 900; margin-bottom: 0.5rem; }
                        .newsletter-date { font-size: 14px; background: rgba(255,255,255,0.15); padding: 6px 15px; border-radius: 8px; }
                        .cover-page, .back-cover-page { width: 210mm; height: 297mm; object-fit: cover; page-break-after: always; }
                        .toc-page { padding: 1rem; background: white; page-break-inside: avoid; }
                        .toc-title { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 1rem; }
                        .toc-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-family: 'Source Sans 3', sans-serif; font-size: 12px; }
                        .article { page-break-inside: avoid; margin: 1rem; }
                        .article img { max-width: 200px; height: auto; border-radius: 8px; }
                        .article-title { font-family: 'Roboto Slab', serif; font-size: 20px; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; }
                        .article-text { font-family: 'Source Sans 3', sans-serif; font-size: 12px; color: #64748b; }
                        .qr-section { text-align: center; margin-top: 1rem; padding: 1rem; border-top: 2px solid #1e3a8a; }
                        .qr-section h3 { font-family: 'Roboto Slab', serif; font-size: 16px; font-weight: 600; margin-bottom: 0.5rem; }
                        .qr-section h4 { font-family: 'Roboto Slab', serif; font-size: 14px; font-weight: 500; margin-bottom: 0.5rem; }
                        .qr-section img { width: 80px; height: 80px; margin: 0.5rem auto; }
                        .newsletter-footer { background: #f8fafc; padding: 1rem; text-align: center; color: #64748b; border-top: 3px solid #1e3a8a; page-break-inside: avoid; }
                        .style-hero { background: #f8fafc; padding: 2rem; text-align: center; }
                        .style-hero .article-image { max-width: 100%; margin-bottom: 1rem; }
                        .style-sidebyside { display: flex; align-items: center; gap: 1rem; }
                        .style-sidebyside .article-image { flex: 1; max-width: 50%; }
                        .style-sidebyside .article-content { flex: 1; }
                        .style-card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
                        .style-magazine { background: white; padding: 1rem; border-left: 4px solid #1e3a8a; }
                        .style-overlay { position: relative; color: white; }
                        .style-overlay .article-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
                        .style-overlay .article-content { background: linear-gradient(transparent, rgba(0,0,0,0.ğŸ˜); color: white; padding: 1rem; width: 100%; }
                        .style-minimal { background: #f8fafc; padding: 1rem; text-align: center; }
                        .style-minimal .article-image { max-width: 200px; margin-bottom: 0.5rem; }
                        @media print {
                            .newsletter { margin: 0; }
                            .article, .newsletter-header, .newsletter-footer { break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="newsletter">${newsletter}</div>
                </body>
                </html>
            `], { type: 'text/html' });
            saveAs(blob, `IPA_Newsletter_${document.getElementById('newsletterYear').value}_${document.getElementById('newsletterMonth').value}.html`);
            showStatus(translations.el.htmlExported, 'success');
        }

        // Export to PDF
        function exportToPdf() {
            const newsletter = document.getElementById('newsletterPreview').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="el">
                <head>
                    <meta charset="UTF-8">
                    <title>IPA Newsletter</title>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=Roboto+Slab:wght@300;400;500;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
                    <style>
                        @page { margin: 0mm; size: A4; }
                        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; background: #f8fafc; }
                        .newsletter { max-width: 210mm; margin: 0 auto; background: white; }
                        .newsletter-header { background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #fbbf24 100%); color: white; padding: 2rem; text-align: center; page-break-inside: avoid; }
                        .newsletter-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 900; margin-bottom: 0.5rem; }
                        .newsletter-date { font-size: 14px; background: rgba(255,255,255,0.15); padding: 6px 15px; border-radius: 8px; }
                        .cover-page, .back-cover-page { width: 210mm; height: 297mm; object-fit: cover; page-break-after: always; }
                        .toc-page { padding: 1rem; background: white; page-break-inside: avoid; }
                        .toc-title { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 1rem; }
                        .toc-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-family: 'Source Sans 3', sans-serif; font-size: 12px; }
                        .article { page-break-inside: avoid; margin: 1rem; }
                        .article img { max-width: 200px; height: auto; border-radius: 8px; }
                        .article-title { font-family: 'Roboto Slab', serif; font-size: 20px; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; }
                        .article-text { font-family: 'Source Sans 3', sans-serif; font-size: 12px; color: #64748b; }
                        .qr-section { text-align: center; margin-top: 1rem; padding: 1rem; border-top: 2px solid #1e3a8a; }
                        .qr-section h3 { font-family: 'Roboto Slab', serif; font-size: 16px; font-weight: 600; margin-bottom: 0.5rem; }
                        .qr-section h4 { font-family: 'Roboto Slab', serif; font-size: 14px; font-weight: 500; margin-bottom: 0.5rem; }
                        .qr-section img { width: 80px; height: 80px; margin: 0.5rem auto; }
                        .newsletter-footer { background: #f8fafc; padding: 1rem; text-align: center; color: #64748b; border-top: 3px solid #1e3a8a; page-break-inside: avoid; }
                        .style-hero { background: #f8fafc; padding: 2rem; text-align: center; }
                        .style-hero .article-image { max-width: 100%; margin-bottom: 1rem; }
                        .style-sidebyside { display: flex; align-items: center; gap: 1rem; }
                        .style-sidebyside .article-image { flex: 1; max-width: 50%; }
                        .style-sidebyside .article-content { flex: 1; }
                        .style-card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
                        .style-magazine { background: white; padding: 1rem; border-left: 4px solid #1e3a8a; }
                        .style-overlay { position: relative; color: white; }
                        .style-overlay .article-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
                        .style-overlay .article-content { background: linear-gradient(transparent, rgba(0,0,0,0.ğŸ˜); color: white; padding: 1rem; width: 100%; }
                        .style-minimal { background: #f8fafc; padding: 1rem; text-align: center; }
                        .style-minimal .article-image { max-width: 200px; margin-bottom: 0.5rem; }
                        @media print {
                            .newsletter { margin: 0; }
                            .article, .newsletter-header, .newsletter-footer { break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="newsletter">${newsletter}</div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            printWindow.onafterprint = () => {
                const blob = new Blob([newsletter], { type: 'text/html' });
                saveAs(blob, `IPA_Newsletter_${document.getElementById('newsletterYear').value}_${document.getElementById('newsletterMonth').value}.pdf`);
                showStatus(translations.el.pdfExported, 'success');
                printWindow.close();
            };
        }

        // Share Online
        async function shareOnline() {
            const newsletter = document.getElementById('newsletterPreview').innerHTML;
            const title = document.getElementById('newsletterTitle').value;
            const month = document.getElementById('newsletterMonth').value;
            const year = document.getElementById('newsletterYear').value;

            try {
                const user = auth.currentUser;
                if (user) {
                    const newsletterRef = db.ref('newsletters').push();
                    await newsletterRef.set({
                        title,
                        month,
                        year,
                        content: newsletter,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    const shareUrl = `https://your-app-url.com/newsletter/${newsletterRef.key}`;
                    showStatus(`${translations.el.shareSuccess} URL: ${shareUrl}`, 'success');
                } else {
                    showStatus(translations.el.shareError, 'error');
                }
            } catch (err) {
                console.error(err);
                showStatus(translations.el.shareError, 'error');
            }
        }
    </script>
</body>
</html>
